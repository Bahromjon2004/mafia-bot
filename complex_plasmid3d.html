
<!doctype html>
<html lang="uz">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Murakkab 3D Plazmid â€” Interactive</title>
<style>
  :root{
    --bg1:#0b1220; --bg2:#0f1724; --glass:rgba(255,255,255,0.04);
    --accent:#60a5fa; --muted:#94a3b8;
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  body{
    background: radial-gradient(1200px 600px at 10% 10%, rgba(96,165,250,0.06), transparent),
                linear-gradient(180deg,var(--bg1),var(--bg2));
    color: #e6eef8;
    -webkit-font-smoothing:antialiased;
    display:flex;align-items:center;justify-content:center;padding:24px;
  }
  .wrap{max-width:1200px;width:100%;display:grid;grid-template-columns:1fr 360px;gap:20px;}
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    border:1px solid rgba(96,165,250,0.06);
    border-radius:14px;padding:18px;box-shadow: 0 8px 30px rgba(2,6,23,0.6);
  }
  header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
  header h1{font-size:18px;margin:0}
  .canvas-wrap{position:relative;padding-top:100%;overflow:hidden;border-radius:12px;}
  #svgCanvas{position:absolute;inset:0;width:100%;height:100%}
  .controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
  .btn{background:linear-gradient(90deg,var(--accent),#8b5cf6);padding:8px 12px;border-radius:10px;color:white;border:none;cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:0 6px 18px rgba(88,98,170,0.12)}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);box-shadow:none;color:var(--muted)}
  .range{display:flex;align-items:center;gap:8px}
  .panel{display:flex;flex-direction:column;gap:12px}
  .comp-item{display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;cursor:pointer}
  .comp-item:hover{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}
  .badge{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px}
  .meta{font-size:12px;color:var(--muted)}
  .info-box{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))}
  .download{margin-top:6px;background:linear-gradient(90deg,#06b6d4,#60a5fa);padding:8px;border-radius:10px;border:none;color:white;cursor:pointer}
  @media (max-width:980px){.wrap{grid-template-columns:1fr;}.panel{order:2}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <header>
      <svg width="44" height="44" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M12 2v20M2 12h20" stroke="#60A5FA" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <div>
        <h1>Murakkab Plazmid â€” 3D Interaktiv Model</h1>
        <div class="meta">Har bir komponent mustaqil harakat qiladi â€” sichqon bilan hover va bosishdan foydalaning</div>
      </div>
    </header>

    <div class="canvas-wrap card" style="padding:14px">
      <svg id="svgCanvas" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg" aria-label="Plasmid visualization">
        <defs>
          <filter id="glow"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>
        <g id="scene">
          <!-- rings and elements will be inserted by JS -->
        </g>
      </svg>
      <!-- overlay controls on top -->
      <div style="position:absolute;left:12px;top:12px;display:flex;gap:8px">
        <button class="btn" id="toggleRotate">To'xtatish</button>
        <button class="btn ghost" id="resetBtn">Qayta</button>
      </div>
      <div style="position:absolute;right:12px;top:12px" class="info-box" id="hoverHint">Hover: komponent/ Click: batafsil</div>
    </div>

    <div class="controls">
      <div class="range">
        <label class="meta">Tilt:</label>
        <input id="tiltRange" type="range" min="0" max="45" value="20" />
      </div>
      <div class="range">
        <label class="meta">Speed:</label>
        <input id="speedRange" type="range" min="0" max="3" step="0.05" value="1" />
      </div>
      <div style="flex:1"></div>
      <button class="btn ghost" id="exportSVG">Export SVG</button>
      <button class="btn" id="exportPNG">Export PNG</button>
    </div>
  </div>

  <aside class="card panel">
    <div class="info-box">
      <strong>Tanlangan komponent:</strong>
      <div id="selectedTitle" style="margin-top:8px;font-weight:700">â€” Hech narsa tanlanmagan â€”</div>
      <div id="selectedDesc" class="meta" style="margin-top:8px">Komponent ustiga bosing yoki ro'yxatdan tanlang.</div>
      <button class="download" id="downloadBtn">HTML-ni yuklab olish</button>
    </div>

    <div style="max-height:420px;overflow:auto">
      <h3 style="margin:10px 0 6px">Barcha komponentlar</h3>
      <div id="componentsList"></div>
    </div>

    <div class="info-box" style="margin-top:8px">
      <div class="meta">Plazmid o'lchami: <strong>~5.8 kb</strong></div>
      <div class="meta">Xost: <strong>E. coli</strong></div>
    </div>
  </aside>
</div>

<script>
  // Data model (uzbek labels)
  const components = [
    { id:'ori', name:'ori', full:'Origin of Replication', desc:'Replikatsiya boshlanish nuqtasi', color:'#3B82F6', pos:0, size:35, icon:'ðŸ”„' },
    { id:'ampr', name:'AmpR', full:'Ampicillin Resistance', desc:'Beta-laktamaza kodlaydi, seleksiya uchun', color:'#10B981', pos:50, size:45, icon:'ðŸ›¡ï¸' },
    { id:'promoter', name:'Promoter', full:'T7/Lac Promoter', desc:'Transkripsiya boshlovchi', color:'#8B5CF6', pos:105, size:25, icon:'â–¶ï¸' },
    { id:'mcs', name:'MCS', full:'Multiple Cloning Site', desc:'Polilinkyer, klonlash uchun', color:'#F59E0B', pos:140, size:30, icon:'âœ‚ï¸' },
    { id:'lacz', name:'lacZ', full:'Beta-Galactosidase', desc:'Skrining gen', color:'#06B6D4', pos:180, size:40, icon:'ðŸ”µ' },
    { id:'terminator', name:'Terminator', full:'Transcription Terminator', desc:"Transkripsiyani to'xtatadi", color:'#EF4444', pos:230, size:20, icon:'â¹ï¸' },
    { id:'kanr', name:'KanR', full:'Kanamycin Resistance', desc:'Ikkinchi selektiv belgi', color:'#F97316', pos:270, size:35, icon:'ðŸ›¡ï¸' },
    { id:'lacI', name:'lacI', full:'Lac Repressor', desc:'Promoterni nazorat qiladi', color:'#EC4899', pos:315, size:30, icon:'ðŸš«' }
  ];

  // Scene & parameters
  const svg = document.getElementById('svgCanvas');
  const scene = document.getElementById('scene');
  const center = { x:200, y:200 };
  let rotation = 0;
  let tilt = 20;
  let speed = 1;
  let running = true;
  const baseRadius = 135;

  // Per-component micro-animations state
  components.forEach(c => {
    c.osc = Math.random()*Math.PI*2;
    c.oscSpeed = 0.002 + Math.random()*0.006;
    c.spin = (Math.random()*2-1)*0.2; // independent micro-rotation
  });

  // Utils
  function degToRad(d){ return d * Math.PI / 180; }
  function polarToXY(angleDeg, radius){
    const a = degToRad(angleDeg + rotation);
    const x = center.x + radius * Math.cos(a);
    const y = center.y + radius * Math.sin(a) * Math.cos(degToRad(tilt));
    const z = radius * Math.sin(a) * Math.sin(degToRad(tilt));
    return {x,y,z};
  }

  // Draw static rings
  function drawRings(){
    const group = document.createElementNS('http://www.w3.org/2000/svg','g');
    for(let i=0;i<6;i++){
      const r = baseRadius - i*6;
      const circ = document.createElementNS('http://www.w3.org/2000/svg','circle');
      circ.setAttribute('cx',center.x);
      circ.setAttribute('cy',center.y);
      circ.setAttribute('r',r);
      circ.setAttribute('fill','none');
      circ.setAttribute('stroke','#60A5FA');
      circ.setAttribute('stroke-width', String(8 - i*1));
      circ.setAttribute('opacity', String(0.35 - i*0.05));
      if(i===0) circ.setAttribute('filter','url(#glow)');
      group.appendChild(circ);
    }
    scene.appendChild(group);
  }

  // Create component segments
  const segGroup = document.createElementNS('http://www.w3.org/2000/svg','g');
  scene.appendChild(segGroup);

  function createSegments(){
    segGroup.innerHTML='';
    components.forEach((comp, idx) => {
      // animated radius oscillation
      const r = baseRadius + Math.sin(comp.osc)*6;
      const start = comp.pos;
      const end = comp.pos + comp.size;
      const startPoint = polarToXY(start, r);
      const endPoint = polarToXY(end, r);
      const largeArc = comp.size > 180 ? 1 : 0;
      const pathStr = `M ${center.x} ${center.y} L ${startPoint.x} ${startPoint.y} A ${r} ${r} 0 ${largeArc} 1 ${endPoint.x} ${endPoint.y} Z`;
      const path = document.createElementNS('http://www.w3.org/2000/svg','path');
      path.setAttribute('d', pathStr);
      path.setAttribute('fill', comp.color);
      path.setAttribute('fill-opacity','0.85');
      path.setAttribute('stroke', '#081229');
      path.setAttribute('stroke-width','1');
      path.setAttribute('data-id',comp.id);
      path.style.transition='transform 0.28s ease, opacity 0.18s';
      if(idx===0) path.setAttribute('filter','url(#glow)');
      segGroup.appendChild(path);

      // moving icon as text
      const mid = comp.pos + comp.size/2 + comp.spin*30;
      const iconPos = polarToXY(mid, r-25);
      const text = document.createElementNS('http://www.w3.org/2000/svg','text');
      text.setAttribute('x', iconPos.x);
      text.setAttribute('y', iconPos.y);
      text.setAttribute('font-size', String(14 + (Math.sin(comp.osc)*2)));
      text.setAttribute('text-anchor','middle');
      text.setAttribute('dominant-baseline','middle');
      text.textContent = comp.icon;
      text.setAttribute('pointer-events','none');
      segGroup.appendChild(text);

      // label bubble
      const labelPos = polarToXY(mid, r+28);
      const label = document.createElementNS('http://www.w3.org/2000/svg','g');
      label.setAttribute('data-id', comp.id+'-label');
      const circ = document.createElementNS('http://www.w3.org/2000/svg','circle');
      circ.setAttribute('cx', labelPos.x);
      circ.setAttribute('cy', labelPos.y);
      circ.setAttribute('r','22');
      circ.setAttribute('fill', comp.color);
      circ.setAttribute('fill-opacity','0.95');
      circ.setAttribute('stroke','white');
      circ.setAttribute('stroke-opacity','0.12');
      label.appendChild(circ);
      const txt = document.createElementNS('http://www.w3.org/2000/svg','text');
      txt.setAttribute('x', labelPos.x);
      txt.setAttribute('y', labelPos.y+1);
      txt.setAttribute('text-anchor','middle');
      txt.setAttribute('dominant-baseline','middle');
      txt.setAttribute('font-size','10');
      txt.setAttribute('fill','white');
      txt.textContent = comp.name;
      label.appendChild(txt);
      segGroup.appendChild(label);

      // tiny connection line
      const line = document.createElementNS('http://www.w3.org/2000/svg','line');
      line.setAttribute('x1', center.x);
      line.setAttribute('y1', center.y);
      line.setAttribute('x2', iconPos.x);
      line.setAttribute('y2', iconPos.y);
      line.setAttribute('stroke', comp.color);
      line.setAttribute('stroke-width','1');
      line.setAttribute('stroke-opacity','0.12');
      line.setAttribute('stroke-dasharray','2,3');
      segGroup.appendChild(line);

      // interactive overlay for hover/click
      path.addEventListener('mouseenter', () => {
        path.style.transform = 'scale(1.03)';
        path.setAttribute('fill-opacity','1');
        showHint(comp);
        highlightList(comp.id,true);
      });
      path.addEventListener('mouseleave', () => {
        path.style.transform = 'scale(1)';
        path.setAttribute('fill-opacity','0.85');
        showHint(null);
        highlightList(comp.id,false);
      });
      path.addEventListener('click', () => selectComponent(comp));
    });
  }

  // selection & UI
  const selectedTitle = document.getElementById('selectedTitle');
  const selectedDesc = document.getElementById('selectedDesc');
  function selectComponent(comp){
    selectedTitle.textContent = comp.name + ' â€” ' + comp.full;
    selectedDesc.textContent = comp.desc;
    // pulse effect on that segment
    const el = segGroup.querySelector('path[data-id="'+comp.id+'"]');
    if(el){
      el.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}], {duration:700,iterations:1});
    }
  }
  function showHint(comp){
    const h = document.getElementById('hoverHint');
    h.textContent = comp ? (comp.name + ' â€” ' + comp.full) : "Hover: komponent/ Click: batafsil";
  }

  // components list in panel
  const listNode = document.getElementById('componentsList');
  function fillList(){
    listNode.innerHTML='';
    components.forEach(c=>{
      const row = document.createElement('div');
      row.className='comp-item';
      row.innerHTML = '<div class="badge" style="background:'+c.color+'40;border:1px solid '+c.color+'22">'+c.icon+'</div><div style="flex:1"><div style="font-weight:700">'+c.name+'</div><div class="meta">'+c.desc+'</div></div>';
      row.addEventListener('mouseenter', ()=> highlightSegment(c.id,true));
      row.addEventListener('mouseleave', ()=> highlightSegment(c.id,false));
      row.addEventListener('click', ()=> selectComponent(c));
      listNode.appendChild(row);
    });
  }

  function highlightSegment(id,on){
    const el = segGroup.querySelector('path[data-id="'+id+'"]');
    if(el){
      el.setAttribute('fill-opacity', on ? '1' : '0.85');
      el.style.transform = on ? 'scale(1.03)' : 'scale(1)';
    }
  }
  function highlightList(id,on){
    const rows = Array.from(listNode.children);
    rows.forEach(r=>{
      if(r.innerText.startsWith(id) || r.innerText.includes(id)){
        r.style.transform = on ? 'scale(1.02)' : 'scale(1)';
        r.style.boxShadow = on ? '0 10px 30px rgba(0,0,0,0.45)' : 'none';
      }
    });
  }

  // main animation loop
  function update(timestamp){
    if(running){
      rotation = (rotation + 0.25 * speed) % 360;
      // update each component micro-oscillation
      components.forEach(c=>{
        c.osc += c.oscSpeed * speed * 1.2;
        c.spin += (Math.random()*2-1)*0.002*speed;
      });
      createSegments();
    } else {
      // still update tiny micro movement for life
      components.forEach(c=>{
        c.osc += c.oscSpeed * 0.25;
      });
      createSegments();
    }
    requestAnimationFrame(update);
  }

  // initial draw
  drawRings();
  fillList();
  createSegments();
  requestAnimationFrame(update);

  // controls
  document.getElementById('tiltRange').addEventListener('input', (e)=>{ tilt = Number(e.target.value); });
  document.getElementById('speedRange').addEventListener('input', (e)=>{ speed = Number(e.target.value); });
  document.getElementById('toggleRotate').addEventListener('click', ()=>{
    running = !running;
    document.getElementById('toggleRotate').textContent = running ? "To'xtatish" : "Aylanish";
  });
  document.getElementById('resetBtn').addEventListener('click', ()=>{
    rotation = 0; tilt = 20; speed = 1; running = true; document.getElementById('tiltRange').value='20'; document.getElementById('speedRange').value='1'; document.getElementById('toggleRotate').textContent="To'xtatish";
  });

  // export SVG
  function downloadURI(uri, name){ const a=document.createElement('a'); a.href=uri; a.download=name; document.body.appendChild(a); a.click(); a.remove(); }
  document.getElementById('exportSVG').addEventListener('click', ()=>{
    const serializer = new XMLSerializer();
    const clone = svg.cloneNode(true);
    // inline styles
    clone.setAttribute('xmlns','http://www.w3.org/2000/svg');
    const str = serializer.serializeToString(clone);
    const blob = new Blob([str], {type:'image/svg+xml;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    downloadURI(url, 'plasmid_visual.svg');
  });
  document.getElementById('exportPNG').addEventListener('click', ()=>{
    const serializer = new XMLSerializer();
    const clone = svg.cloneNode(true);
    clone.setAttribute('xmlns','http://www.w3.org/2000/svg');
    const str = serializer.serializeToString(clone);
    const img = new Image();
    const blob = new Blob([str], {type:'image/svg+xml;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    img.onload = function(){
      const canvas = document.createElement('canvas');
      canvas.width = 1600; canvas.height = 1600;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = getComputedStyle(document.body).backgroundColor;
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img,0,0,canvas.width,canvas.height);
      const png = canvas.toDataURL('image/png');
      downloadURI(png, 'plasmid_visual.png');
      URL.revokeObjectURL(url);
    };
    img.src = url;
  });

  // download the HTML (self) for the user
  document.getElementById('downloadBtn').addEventListener('click', ()=>{
    const html = '<!doctype html>\\n' + document.documentElement.outerHTML;
    const blob = new Blob([html], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    downloadURI(url, 'complex_plasmid3d.html');
  });

  // provide initial selection
  selectComponent(components[0]);

  // Accessibility: keyboard navigation (numbers 1..8 to select)
  window.addEventListener('keydown', (e)=>{
    if(e.key >= '1' && e.key <= String(components.length)){
      const idx = Number(e.key)-1;
      selectComponent(components[idx]);
    }
  });

  // Expose a global for debugging (optional)
  window._plasmid = { components, svg, segGroup };
</script>
</body>
</html>
